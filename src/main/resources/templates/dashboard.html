<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard v4.0 - Court Booking System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        
        /* Header & Navigation */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.8em; }
        .user-info { display: flex; align-items: center; gap: 20px; }
        .user-name { font-weight: bold; }
        .logout-btn { background: rgba(255,255,255,0.2); color: #fff; padding: 8px 20px; text-decoration: none; border-radius: 5px; border: 1px solid rgba(255,255,255,0.3); }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        
        /* Navigation Tabs */
        .nav-tabs { background: #fff; border-bottom: 2px solid #e0e0e0; position: relative; z-index: 10; }
        .nav-tabs-content { max-width: 1200px; margin: 0 auto; display: flex; gap: 0; }
        .nav-tab { 
            padding: 15px 30px; 
            cursor: pointer; 
            border-bottom: 3px solid transparent; 
            transition: all 0.3s; 
            user-select: none;
            position: relative;
            z-index: 11;
        }
        .nav-tab:hover { background: #f9f9f9; }
        .nav-tab.active { border-bottom-color: #667eea; color: #667eea; font-weight: bold; }
        
        /* Container */
        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        /* Tab Content */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Court Cards */
        .courts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .court-card { background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .court-card:hover { transform: translateY(-5px); box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .court-name { font-size: 1.5em; font-weight: bold; color: #333; margin-bottom: 10px; }
        .court-type { display: inline-block; background: #667eea; color: #fff; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 10px; }
        .court-location { color: #666; margin: 10px 0; }
        .court-price { font-size: 1.3em; color: #764ba2; font-weight: bold; margin: 10px 0; }
        .court-status { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 0.85em; }
        .court-status.active { background: #4caf50; color: #fff; }
        .court-status.inactive { background: #f44336; color: #fff; }
        
        /* Review Stats Badge */
        .court-review-stats { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            margin: 12px 0;
            padding: 8px 12px;
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            border-radius: 8px;
            color: white;
            font-size: 0.9em;
            box-shadow: 0 2px 8px rgba(255, 165, 0, 0.3);
        }
        .review-stars { 
            font-size: 1.1em; 
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .review-count { 
            font-size: 0.85em; 
            opacity: 0.95;
        }
        .no-reviews {
            background: linear-gradient(135deg, #999 0%, #777 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            text-align: center;
            margin: 10px 0;
        }
        
        .book-btn { background: #667eea; color: #fff; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 15px; font-size: 1em; }
        .book-btn:hover { background: #5568d3; }
        
        /* Bookings Table */
        .bookings-table { width: 100%; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 20px; }
        .bookings-table table { width: 100%; border-collapse: collapse; }
        .bookings-table th { background: #667eea; color: #fff; padding: 15px; text-align: left; }
        .bookings-table td { padding: 15px; border-bottom: 1px solid #e0e0e0; }
        .bookings-table tr:hover { background: #f9f9f9; }
        .status-badge { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 0.85em; font-weight: bold; }
        .status-pending { background: #ff9800; color: #fff; }
        .status-confirmed { background: #4caf50; color: #fff; }
        .status-completed { background: #2196f3; color: #fff; }
        .status-cancelled { background: #f44336; color: #fff; }
        
        /* Filters */
        .filters { background: #fff; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .filter-group { display: inline-block; margin-right: 20px; }
        .filter-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        .filter-group select, .filter-group input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 1em; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state svg { width: 100px; height: 100px; margin-bottom: 20px; opacity: 0.3; }
        
        /* Action Buttons */
        .action-btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; font-size: 0.9em; }
        .btn-cancel { background: #f44336; color: #fff; }
        .btn-review { background: #2196f3; color: #fff; }
        .btn-cancel:hover { background: #d32f2f; }
        .btn-review:hover { background: #1976d2; }
        
        /* Admin Section */
        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
        .stat-value { font-size: 2.5em; font-weight: bold; color: #667eea; }
        .stat-label { color: #666; margin-top: 5px; }
        
        .add-court-btn { background: #4caf50; color: #fff; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; margin-bottom: 20px; }
        .add-court-btn:hover { background: #45a049; }
    </style>
</head>
<body th:data-is-admin="${isAdmin}" th:data-is-court-owner="${isCourtOwner}">
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1>üèüÔ∏è Court Booking System</h1>
            <div class="user-info">
                <span class="user-name">üë§ <span th:text="${userName}">User</span></span>
                <span th:if="${isAdmin}" style="background: #ffc107; color: #333; padding: 5px 10px; border-radius: 15px; font-size: 0.85em;">ADMIN</span>
                <span th:if="${isCourtOwner}" style="background: #4caf50; color: #fff; padding: 5px 10px; border-radius: 15px; font-size: 0.85em;">COURT OWNER</span>
                <a href="/logout" class="logout-btn">Logout</a>
            </div>
        </div>
    </div>
    
    <!-- Navigation Tabs -->
    <div class="nav-tabs" style="background: #fff; border-bottom: 2px solid #e0e0e0;">
        <div class="nav-tabs-content" style="max-width: 1200px; margin: 0 auto; display: flex; gap: 0;">
            <a href="#courts" class="nav-tab active" style="padding: 15px 30px; cursor: pointer; border-bottom: 3px solid #667eea; transition: all 0.3s; text-decoration: none; color: #667eea; font-weight: bold; display: block;" onclick="switchTab('courts', event); return false;">üèüÔ∏è Available Courts</a>
            <a href="#bookings" class="nav-tab" style="padding: 15px 30px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; text-decoration: none; color: #333; display: block;" onclick="switchTab('bookings', event); return false;">üìÖ My Bookings</a>
            <a href="#owner-courts" class="nav-tab" th:if="${isCourtOwner}" style="padding: 15px 30px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; text-decoration: none; color: #333; display: block;" onclick="switchTab('owner-courts', event); return false;">üèóÔ∏è My Courts</a>
            <a href="#revenue" class="nav-tab" th:if="${isCourtOwner}" style="padding: 15px 30px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; text-decoration: none; color: #333; display: block;" onclick="switchTab('revenue', event); return false;">üí∞ Revenue</a>
            <a href="#manage-courts" class="nav-tab" th:if="${isAdmin}" style="padding: 15px 30px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; text-decoration: none; color: #333; display: block;" onclick="switchTab('manage-courts', event); return false;">üèóÔ∏è Manage Courts</a>
            <a href="#admin" class="nav-tab" th:if="${isAdmin}" style="padding: 15px 30px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; text-decoration: none; color: #333; display: block;" onclick="switchTab('admin', event); return false;">‚öôÔ∏è Admin Panel</a>
        </div>
    </div>
    
    <div class="container">
        <!-- Courts Tab -->
        <div id="courts-tab" class="tab-content active">
            <div class="filters">
                <div class="filter-group">
                    <label>Court Type:</label>
                    <select id="courtTypeFilter" onchange="filterCourts()">
                        <option value="">All Types</option>
                        <option value="FOOTBALL">Football</option>
                        <option value="BADMINTON">Badminton</option>
                        <option value="TENNIS">Tennis</option>
                        <option value="FUTSAL">Futsal</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Status:</label>
                    <select id="statusFilter" onchange="filterCourts()">
                        <option value="">All Status</option>
                        <option value="ACTIVE">Active</option>
                        <option value="INACTIVE">Inactive</option>
                    </select>
                </div>
            </div>
            
            <div class="courts-grid" id="courtsGrid">
                <!-- Courts will be loaded here via JavaScript -->
            </div>
        </div>
        
        <!-- Bookings Tab -->
        <div id="bookings-tab" class="tab-content">
            <div class="bookings-table">
                <table>
                    <thead>
                        <tr>
                            <th>Booking ID</th>
                            <th>Court</th>
                            <th>Sub-Court</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Total Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsTableBody">
                        <!-- Bookings will be loaded here via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Owner Courts Tab (Court Owner Only) -->
        <div id="owner-courts-tab" class="tab-content" th:if="${isCourtOwner}">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2>üèóÔ∏è My Courts</h2>
                <button class="add-court-btn" onclick="showOwnerAddCourtModal()" style="background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Add New Court</button>
            </div>
            
            <div class="bookings-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Price/Hour</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ownerCourtsTableBody">
                        <!-- Owner's courts will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 40px;">
                <h3>üìä Bookings for My Courts</h3>
                <div class="bookings-table" style="margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Court</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ownerBookingsTableBody">
                            <!-- Bookings for owner's courts -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Manage Courts Tab (Admin Only) -->
        <div id="manage-courts-tab" class="tab-content" th:if="${isAdmin}">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2>üèóÔ∏è Manage Courts</h2>
                <button class="add-court-btn" onclick="showAddCourtModal()" style="background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">‚ûï Add New Court</button>
            </div>
            
            <div class="bookings-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Price/Hour</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="manageCourtsTableBody">
                        <!-- Courts will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Revenue Tab (Court Owner Only) -->
        <div id="revenue-tab" class="tab-content" th:if="${isCourtOwner}">
            <h2 style="margin-bottom: 25px; color: #333;">üí∞ Revenue Analytics Dashboard</h2>
            
            <!-- Stats Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">Total Revenue</div>
                    <div style="font-size: 32px; font-weight: bold;" id="ownerTotalRevenue">$0</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">All time earnings</div>
                </div>
                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">This Month</div>
                    <div style="font-size: 32px; font-weight: bold;" id="ownerMonthlyRevenue">$0</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">Current month revenue</div>
                </div>
                <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">Total Bookings</div>
                    <div style="font-size: 32px; font-weight: bold;" id="ownerTotalBookings">0</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">Completed orders</div>
                </div>
                <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">Active Bookings</div>
                    <div style="font-size: 32px; font-weight: bold;" id="ownerActiveBookings">0</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">Pending & confirmed</div>
                </div>
            </div>
            
            <!-- Charts Row -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px;">
                <div style="background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 20px; color: #333; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                        üìà Revenue Trend (Last 7 Days)
                    </h3>
                    <canvas id="revenueChart" style="max-height: 300px;"></canvas>
                </div>
                <div style="background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
                    <h3 style="margin-bottom: 20px; color: #333; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                        üìä Booking Status
                    </h3>
                    <canvas id="bookingStatusChart"></canvas>
                </div>
            </div>
            
            <!-- Revenue by Court Table -->
            <div style="background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); overflow: hidden;">
                <div style="padding: 20px 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3 style="margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                        üèüÔ∏è Revenue by Court
                    </h3>
                </div>
                <div class="bookings-table" style="margin: 0;">
                    <table>
                        <thead>
                            <tr>
                                <th>Court Name</th>
                                <th>Total Bookings</th>
                                <th>Total Revenue</th>
                                <th>This Month</th>
                            </tr>
                        </thead>
                        <tbody id="revenueByCourtTableBody">
                            <tr><td colspan="4" style="text-align: center; padding: 40px;">Loading revenue data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Admin Tab -->
        <div id="admin-tab" class="tab-content" th:if="${isAdmin}">
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalCourts">0</div>
                    <div class="stat-label">Total Courts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalBookings">0</div>
                    <div class="stat-label">Total Bookings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">$0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>
            
            <button class="add-court-btn" onclick="showAddCourtModal()">‚ûï Add New Court</button>
            
            <div class="bookings-table">
                <h2 style="padding: 20px; background: #fff;">All Bookings</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>User</th>
                            <th>Court</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminBookingsTableBody">
                        <!-- All bookings will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Load external JavaScript file -->
    <script th:src="@{/js/dashboard.js}"></script>

</body>
</html>
